gama=4
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
col=rep('red',n)
col[nulls_ind]='black'
plot(p_seq,col=col)
plot(abs(cusum_function(p_seq)))
(est_cusum=which.max(abs(cusum_function(p_seq))))
(fdr_cusum=sum(col[1:est_cusum]=='black')/est_cusum)
(power_cusum=sum(col[1:est_cusum]=='red')/k)
est_gsell=forward_stop(p_seq,0.25)
(fdr_gsell=sum(col[1:est_gsell]=='black')/est_cusum)
(power_gsell=sum(col[1:est_gsell]=='red')/k)
n=100
p_seq=c(rbeta(k,1,8),runif(n-k))
plot(p_seq)
help(sample)
gama=4
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
col=rep('red',n)
col[nulls_ind]='black'
plot(p_seq,col=col)
n=100
p_seq=c(rbeta(k,1,8),runif(n-k))
plot(p_seq)
help(sample)
gama=4
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
col=rep('red',n)
col[nulls_ind]='black'
plot(p_seq,col=col)
est_gsell=forward_stop(p_seq,0.05)
(fdr_gsell=sum(col[1:est_gsell]=='black')/est_cusum)
(power_gsell=sum(col[1:est_gsell]=='red')/k)
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell=forward_stop(p_seq,0.25)
fdr_gsell[i]=sum(col[1:est_gsell]==0)/est_cusum
power_gsell[i]=sum(col[1:est_gsell]==1)/k
}
N=1000
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell]==0)/est_cusum
power_gsell[i]=sum(col[1:est_gsell]==1)/k
}
N=1000
k=40
n=100
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell]==0)/est_cusum
power_gsell[i]=sum(col[1:est_gsell]==1)/k
}
N=1000
k=40
n=100
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell[i]=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_cusum
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
forward_stop(p_seq,0.05)
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
sig
est_cusum=which.max(abs(cusum_function(p_seq)))
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum[i]=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell[i]=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_cusum
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum[i]=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum[i]
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell[i]=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_gsell[i]
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
n=100
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum[i]=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum[i]
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell[i]=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_gsell[i]
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum[i]=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum[i]]==0)/est_cusum[i]
power_cusum[i]=sum(col[1:est_cusum[i]]==1)/k
est_gsell[i]=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_gsell[i]
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum[i]]==0)/est_cusum[i]
power_cusum[i]=sum(col[1:est_cusum[i]]==1)/k
est_gsell=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell[i]]==0)/est_gsell[i]
power_gsell[i]=sum(col[1:est_gsell[i]]==1)/k
}
n=100
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
fdr_cusum[i]=sum(col[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(col[1:est_cusum]==1)/k
est_gsell=forward_stop(p_seq,0.05)
fdr_gsell[i]=sum(col[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(col[1:est_gsell]==1)/k
}
bh_est
bh_adaptive
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,0.05)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
aph
alpha
cusum_function
forward_stop(p_seq,0.05)
forward_stop=function(p_seq,alpha)
{
n=length(p_seq)
k=1:n
max(0,max(which(-cumsum(log(1-p_seq))/k<=alpha)))
}
forward_stop(p_seq,0.05)
forward_stop(p_seq,0.05)
n=length(p_seq)
k=1:n
max(0,max(which(-cumsum(log(1-p_seq))/k<=alpha)))
max(which(-cumsum(log(1-p_seq))/k<=alpha))
forward_stop=function(p_seq,alpha)
{
n=length(p_seq)
k=1:n
if(is.infinite(max(which(-cumsum(log(1-p_seq))/k<=alpha))))
return(0)
else return(max(which(-cumsum(log(1-p_seq))/k<=alpha)))
}
orward_stop(p_seq,0.05)
forward_stop(p_seq,0.05)
forward_stop=function(p_seq,alpha)
{
n=length(p_seq)
k=1:n
if(is.infinite(max(which(-cumsum(log(1-p_seq))/k<=alpha))))
return(0)
else return(max(which(-cumsum(log(1-p_seq))/k<=alpha)))
}
is.infinite(max(which(-cumsum(log(1-p_seq))/k<=alpha)))
cumsum
-cumsum(log(1-p_seq))/k
-cumsum(log(1-p_seq))/k<=alpha
which(-cumsum(log(1-p_seq))/k<=alpha)
sum(-cumsum(log(1-p_seq))/k<=alpha)
sum(-cumsum(log(1-p_seq))/k<=alpha)
sum(-cumsum(log(1-p_seq))/k<=alpha)
sum(-cumsum(log(1-p_seq))/k<=alpha)==0
(sum(-cumsum(log(1-p_seq))/k<=alpha)==0)
forward_stop=function(p_seq,alpha)
{
n=length(p_seq)
k=1:n
if(sum(-cumsum(log(1-p_seq))/k<=alpha)==0)
return(0)
else return(max(which(-cumsum(log(1-p_seq))/k<=alpha)))
}
N=1000
k=40
n=100
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,0.05)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
plot(p_seq)
boxplot(fdr_cusum,fdr_gsell)
boxplot(fdr_cusum,fdr_gsell)
boxplkot(power_cusum,power_gsell)
boxplot(power_cusum,power_gsell)
alpha=0.1
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,0.05)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
boxplot(fdr_cusum,fdr_gsell)
N=1000
k=40
n=100
alpha=0.1
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,alpha)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
N=1000
k=40
n=100
alpha=0.1
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,alpha)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
N=1000
k=40
n=100
alpha=0.3
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,alpha)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
N=1000
k=40
n=100
alpha=0.3
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,alpha)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
N=1000
k=40
n=100
alpha=0.2
fdr_cusum=fdr_gsell=power_cusum=power_gsell=rep(0,N)
for(i in 1:N)
{
nulls_ind=sort(sample(n,n-k,prob=(1:n)^gama/sum((1:n)^gama)))
p_seq=rbeta(n,1,8)
p_seq[nulls_ind]=runif(n-k)
sig=rep(1,n)
sig[nulls_ind]=0
est_cusum=which.max(abs(cusum_function(p_seq)))
if( est_cusum==0){
fdr_cusum[i]=0
power_cusum[i]=0
}
else{
fdr_cusum[i]=sum(sig[1:est_cusum]==0)/est_cusum
power_cusum[i]=sum(sig[1:est_cusum]==1)/k
}
est_gsell=forward_stop(p_seq,alpha)
if( est_gsell==0){
fdr_gsell[i]=0
power_gsell[i]=0
}
else{
fdr_gsell[i]=sum(sig[1:est_gsell]==0)/est_gsell
power_gsell[i]=sum(sig[1:est_gsell]==1)/k
}
}
boxplot(fdr_cusum,fdr_gsell)
boxplot(power_cusum,power_gsell)
